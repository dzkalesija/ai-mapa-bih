<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Monitor BiH | Nacionalna Mapa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;600&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0b1120; color: #f1f5f9; font-family: 'Inter', sans-serif; }
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .card-opt { border: 1px solid rgba(255,255,255,0.05); cursor: pointer; background: rgba(30, 41, 59, 0.4); transition: 0.2s; }
        .selected { border-color: #3b82f6 !important; background: rgba(59, 130, 246, 0.2) !important; color: #60a5fa; }
        input[type="checkbox"] { display: none; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-slate-950">

<div class="max-w-4xl w-full glass p-8 md:p-12 rounded-[2rem] shadow-2xl">
    <form id="monitorForm">
        <div class="step active" id="step1">
            <h1 class="text-center text-blue-400 tracking-[0.4em] uppercase text-xl mb-10 font-light">AI Monitor BiH</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <select id="entitet" onchange="fillOpcine()" class="bg-slate-900 border border-slate-800 p-4 rounded-xl text-xs text-slate-300 outline-none focus:border-blue-500">
                    <option value="">Odaberi regiju...</option>
                    <option value="FBiH">Federacija BiH</option>
                    <option value="RS">Republika Srpska</option>
                    <option value="BD">Brčko Distrikt</option>
                </select>
                <select id="opcina" class="bg-slate-900 border border-slate-800 p-4 rounded-xl text-xs text-slate-300 outline-none">
                    <option value="">Općina...</option>
                </select>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10">
                <select id="sektor" onchange="updateSubSectors()" class="bg-slate-900 border border-slate-800 p-4 rounded-xl text-xs text-blue-300 outline-none">
                    <option value="">Glavni sektor...</option>
                    <option value="obrazovanje">Obrazovanje i Nauka</option>
                    <option value="privreda">Privreda i Industrija</option>
                    <option value="javni">Javna Uprava i Zdravstvo</option>
                    <option value="kreativa">Kreativna Industrija i IT</option>
                </select>
                <select id="pod_sektor" onchange="enableNext1()" class="bg-slate-900 border border-slate-800 p-4 rounded-xl text-xs text-emerald-400 outline-none">
                    <option value="">Specifična oblast...</option>
                </select>
            </div>
            <button type="button" id="btn1" onclick="next(2)" disabled class="w-full bg-blue-600/20 p-5 rounded-xl text-[10px] uppercase tracking-widest opacity-50 cursor-not-allowed">Nastavi</button>
        </div>

        <div class="step" id="step2">
            <h2 id="naslov_oblasti" class="text-center text-blue-400 uppercase text-[10px] mb-8 tracking-[0.2em]"></h2>
            <div id="pitanja_container" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-10"></div>
            <button type="button" onclick="next(3)" class="w-full bg-blue-600/40 p-5 rounded-xl text-[10px] uppercase tracking-widest">Sledeće: Alati</button>
        </div>

        <div class="step" id="step3">
            <div id="alati_grid" class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-10"></div>
            <div class="text-center mb-10">
                <label class="text-[9px] uppercase text-slate-500 block mb-2">Procjena uštede vremena (%)</label>
                <input type="range" id="usteda" min="0" max="100" value="20" class="w-full h-1 bg-slate-800 appearance-none accent-blue-500" oninput="uVal.innerText=this.value+'%'">
                <div id="uVal" class="mt-2 text-lg text-blue-400">20%</div>
            </div>
            <button type="button" onclick="posalji()" class="w-full bg-emerald-600/40 p-6 rounded-2xl text-[10px] uppercase font-bold tracking-[0.2em]">Generiši Rezultat</button>
        </div>

        <div class="step text-center" id="step4">
            <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-4">Index Digitalne Adaptacije (IDA)</p>
            <h1 id="score_val" class="text-8xl font-thin text-blue-400 mb-10">0</h1>
            <button type="button" onclick="location.reload()" class="text-slate-600 hover:text-white text-[9px] uppercase border-b border-slate-800 pb-1">Novi unos</button>
        </div>
    </form>
</div>

<script>
    const opcineBiH = {
        "FBiH": ["Sarajevo-Centar", "Sarajevo-Novi Grad", "Sarajevo-Stari Grad", "Sarajevo-Novo Sarajevo", "Tuzla", "Mostar", "Zenica", "Bihać", "Travnik", "Bugojno", "Cazin", "Konjic", "Visoko", "Goražde", "Gradačac", "Lukavac", "Kakanj", "Srebrenik", "Gračanica", "Živinice"],
        "RS": ["Banja Luka", "Bijeljina", "Prijedor", "Doboj", "Istočno Sarajevo", "Trebinje", "Gradiška", "Prnjavor", "Laktaši", "Derventa", "Pale", "Modriča", "Kozarska Dubica", "Teslić", "Zvornik"],
        "BD": ["Brčko Distrikt"]
    };

    const sektorskaMapa = {
        "obrazovanje": [
            {id:"os", name:"Osnovna škola", q:["Pomoć u nastavi", "Učenje jezika", "Kreativno pisanje", "Organizacija gradiva"]},
            {id:"ss", name:"Srednja škola", q:["Istraživački radovi", "Priprema ispita", "Kodiranje", "Matematički modeli"]},
            {id:"ak", name:"Fakultet / Akademija", q:["Analiza podataka", "Pisanje radova", "Pregled literature", "Simulacije"]}
        ],
        "privreda": [
            {id:"ind", name:"Industrija", q:["Održavanje mašina", "Logistika", "Kontrola kvaliteta", "Energetska efikasnost"]},
            {id:"agr", name:"Poljoprivreda", q:["Analiza tla", "Satelitsko praćenje", "Prognoza prinosa", "Detekcija bolesti"]},
            {id:"gra", name:"Građevinarstvo", q:["3D dizajn", "Proračun troškova", "Planiranje faza", "Renderisanje"]}
        ],
        "javni": [
            {id:"adm", name:"Javna Uprava", q:["Automatizacija servisa", "Obrada dokumenata", "Pravni nacrti", "Klasifikacija arhiva"]},
            {id:"med", name:"Zdravstvo", q:["Analiza nalaza", "Trijaža pacijenata", "Medicinski izvještaji", "Baza lijekova"]}
        ],
        "kreativa": [
            {id:"it", name:"Software Development", q:["Generisanje koda", "Debugiranje", "Arhitektura", "Testiranje"]},
            {id:"des", name:"Dizajn i Art", q:["Koncept art", "Video montaža", "Obrada slike", "Copywriting"]}
        ]
    };

    const alatiList = ["ChatGPT", "Claude", "Gemini", "DeepSeek", "Midjourney", "Perplexity", "Copilot", "Canva", "ElevenLabs", "Sora"];

    function fillOpcine() {
        const e = document.getElementById('entitet').value;
        const o = document.getElementById('opcina');
        o.innerHTML = '<option value="">Općina...</option>';
        if(e) opcineBiH[e].sort().forEach(x => o.innerHTML += `<option value="${x}">${x}</option>`);
    }

    function updateSubSectors() {
        const s = document.getElementById('sektor').value;
        const ps = document.getElementById('pod_sektor');
        ps.innerHTML = '<option value="">Oblast...</option>';
        if(s) sektorskaMapa[s].forEach(x => ps.innerHTML += `<option value="${x.id}">${x.name}</option>`);
    }

    function enableNext1() {
        const btn = document.getElementById('btn1');
        if(document.getElementById('pod_sektor').value) {
            btn.disabled = false; btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }

    function next(s) {
        if(s===2) {
            const sVal = document.getElementById('sektor').value;
            const psVal = document.getElementById('pod_sektor').value;
            const oblast = sektorskaMapa[sVal].find(x => x.id === psVal);
            document.getElementById('naslov_oblasti').innerText = "Primjena u oblasti: " + oblast.name;
            const c = document.getElementById('pitanja_container');
            c.innerHTML = '';
            oblast.q.forEach(q => {
                const d = document.createElement('div');
                d.className = "card-opt p-4 rounded-xl text-[10px] uppercase text-center flex items-center justify-center";
                d.innerHTML = `<input type="checkbox" name="odgovor" value="${q}">${q}`;
                d.onclick = () => { d.querySelector('input').click(); d.classList.toggle('selected'); };
                c.appendChild(d);
            });
        }
        if(s===3 && document.getElementById('alati_grid').innerHTML === '') {
            alatiList.forEach(a => {
                const d = document.createElement('div');
                d.className = "card-opt p-3 rounded-lg text-[9px] text-center";
                d.innerText = a;
                d.onclick = () => d.classList.toggle('selected');
                document.getElementById('alati_grid').appendChild(d);
            });
        }
        document.querySelectorAll('.step').forEach(x => x.classList.remove('active'));
        document.getElementById('step' + s).classList.add('active');
    }

    async function posalji() {
        const alati = Array.from(document.querySelectorAll('#alati_grid .selected')).map(x => x.innerText);
        const odgovori = Array.from(document.querySelectorAll('input[name="odgovor"]:checked')).map(x => x.value);
        const usteda = parseInt(document.getElementById('usteda').value);
        
        let score = (35 + (odgovori.length * 9) + (alati.length * 4) + (usteda * 0.2)).toFixed(1);
        score = Math.min(score, 100);

        const data = {
            entitet: document.getElementById('entitet').value,
            opcina: document.getElementById('opcina').value,
            sektor: document.getElementById('sektor').options[document.getElementById('sektor').selectedIndex].text,
            pod_sektor: document.getElementById('pod_sektor').options[document.getElementById('pod_sektor').selectedIndex].text,
            odgovori: odgovori.join(", ") || "Nema",
            alati: alati.join(", ") || "Nema",
            usteda: usteda,
            stav: "Pozitivan",
            score: parseFloat(score)
        };

        document.getElementById('score_val').innerText = score;
        next(4);

        await fetch('https://ai-mapa-bih-1.onrender.com/submit-survey', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
    }
</script>
</body>
</html>