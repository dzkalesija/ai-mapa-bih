<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mapa BiH - Istraživanje</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; }
        .step { display: none; }
        .step.active { display: block; }
        .selected { border-color: #3b82f6 !important; background-color: rgba(59, 130, 246, 0.2); }
    </style>
</head>
<body class="p-6">

    <div class="max-w-2xl mx-auto bg-slate-800 p-8 rounded-3xl border border-slate-700 shadow-xl">
        <form id="aiForm">
            <div class="step active" id="step1">
                <h2 class="text-2xl font-bold mb-6">1. Osnovni podaci</h2>
                <select id="entitet" class="w-full p-4 mb-4 bg-slate-900 border border-slate-700 rounded-xl" onchange="fillOpcine()">
                    <option value="">Odaberi entitet...</option>
                    <option value="FBiH">Federacija BiH</option>
                    <option value="RS">Republika Srpska</option>
                    <option value="BD">Brčko Distrikt</option>
                </select>
                <select id="opcina" class="w-full p-4 mb-4 bg-slate-900 border border-slate-700 rounded-xl">
                    <option value="">Prvo odaberi entitet...</option>
                </select>
                <select id="struka" class="w-full p-4 mb-6 bg-slate-900 border border-slate-700 rounded-xl">
                    <option value="IT">IT Sektor</option>
                    <option value="Obrazovanje">Obrazovanje</option>
                    <option value="Student">Student</option>
                    <option value="Ostalo">Ostalo</option>
                </select>
                <button type="button" onclick="next(2)" class="w-full bg-blue-600 p-4 rounded-xl font-bold">Dalje</button>
            </div>

            <div class="step" id="step2">
                <h2 class="text-2xl font-bold mb-6">2. Alati i ušteda</h2>
                <div class="grid grid-cols-2 gap-2 mb-6" id="toolsGrid"></div>
                <label class="block mb-2 text-sm text-slate-400">Procijenjena ušteda vremena (%):</label>
                <input type="range" id="usteda" min="0" max="100" value="20" class="w-full mb-6">
                <button type="button" onclick="next(3)" class="w-full bg-blue-600 p-4 rounded-xl font-bold">Dalje</button>
            </div>

            <div class="step" id="step3">
                <h2 class="text-2xl font-bold mb-6">3. Finalizacija</h2>
                <p class="mb-4 text-slate-400 text-sm">Klikom na dugme šaljete podatke u nacionalnu bazu.</p>
                <button type="button" id="subBtn" onclick="submitSurvey()" class="w-full bg-emerald-600 p-4 rounded-xl font-bold italic">POŠALJI PODATKE</button>
            </div>

            <div class="step text-center" id="step4">
                <h2 class="text-4xl font-black text-blue-400 mb-4">Hvala!</h2>
                <p>Vaši podaci su uspješno sačuvani u bazi.</p>
                <button type="button" onclick="location.reload()" class="mt-6 text-sm underline text-slate-500">Novi unos</button>
            </div>
        </form>
    </div>

    <script>
        const opcine = { "FBiH": ["Sarajevo", "Tuzla", "Mostar", "Zenica"], "RS": ["Banja Luka", "Bijeljina", "Trebinje"], "BD": ["Brčko"] };
        const alati = ["ChatGPT", "Claude", "Gemini", "Midjourney"];
        let odabraniAlati = [];

        function fillOpcine() {
            const e = document.getElementById('entitet').value;
            const s = document.getElementById('opcina');
            s.innerHTML = '';
            (opcine[e] || []).forEach(o => s.innerHTML += `<option value="${o}">${o}</option>`);
        }

        const grid = document.getElementById('toolsGrid');
        alati.forEach(a => {
            const d = document.createElement('div');
            d.className = "p-3 bg-slate-900 border border-slate-700 rounded-xl text-center cursor-pointer text-sm";
            d.innerText = a;
            d.onclick = function() { this.classList.toggle('selected'); if(odabraniAlati.includes(a)) odabraniAlati = odabraniAlati.filter(x=>x!==a); else odabraniAlati.push(a); };
            grid.appendChild(d);
        });

        function next(s) {
            document.querySelectorAll('.step').forEach(x => x.classList.remove('active'));
            document.getElementById('step'+s).classList.add('active');
        }

        async function submitSurvey() {
            // Blokada (isključena ako se doda ?test=1 u URL)
            const isTest = new URLSearchParams(window.location.search).has('test');
            if(localStorage.getItem('anketa_sent') && !isTest) {
                alert("Već ste popunili anketu!");
                return;
            }

            const btn = document.getElementById('subBtn');
            btn.disabled = true;
            btn.innerText = "SLANJE... (BUĐENJE SERVERA)";

            const data = {
                entitet: document.getElementById('entitet').value,
                opcina: document.getElementById('opcina').value,
                struka: document.getElementById('struka').value,
                alati: odabraniAlati.join(", "),
                ustedjeno_vrijeme: parseInt(document.getElementById('usteda').value),
                uticaj_na_posao: "Pozitivan",
                ai_iq_score: 50.0 // Ovdje može ići tvoja formula
            };

            try {
                const res = await fetch('https://ai-mapa-bih-1.onrender.com/submit-survey', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if(res.ok) {
                    localStorage.setItem('anketa_sent', 'true');
                    next(4);
                } else {
                    alert("Greška na serveru. Pokušajte ponovo.");
                    btn.disabled = false;
                }
            } catch (e) {
                alert("Server se još budi. Kliknite OK i sačekajte 5 sekundi, pa probajte opet.");
                btn.disabled = false;
                btn.innerText = "POKUŠAJ PONOVO";
            }
        }
    </script>
</body>
</html>